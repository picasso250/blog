测试案例列表
------------

（请根据流程图来做
http://picasso250.github.com/cheng/flow/start.html
）

1. **主流程**
http://picasso250.github.com/cheng/flow/main_sys.html

1. **付账给工厂流程**
http://picasso250.github.com/cheng/flow/pay_factory.html

1. **工厂消耗石头流程**
http://picasso250.github.com/cheng/flow/stone_factory.html

1. **用户定制流程**
http://picasso250.github.com/cheng/flow/customize_sys.html

1. **客户充值流程**
http://picasso250.github.com/cheng/flow/recharge_customer.html

1. **工厂充值流程**
http://picasso250.github.com/cheng/flow/recharge_factory.html

1. **工厂充石流程**
http://picasso250.github.com/cheng/flow/recharge_factory_stone.html

订单状态列表
------------

**现有的列表**

第一列的状态将会显示在左边的导航条里，第二列的按钮将会显示在订单管理中。

|  状态名称  | 下一步按钮 |  下一步函数名  |       含义       | where |
|:-----------|:----------:|:---------------|:-----------------|:----|
| 待确认     | 审核       | confirm        | 用户已经提交订单 | cus.submit |
| 已交工厂   | 完工       | facotryDone    | 确认这笔交易使得 | cus.confirm fac.in |
| 工厂完工   | 确认售价   | confirmPriceOf | 工厂价格固定     | fac.finish |
| 用户未结清 |            |                | 客户价格固定，但客户的款还没到（齐） | cus.tobepaid |
| 工厂未结清 |            |                | 工厂的款还没给打过去（完） | fac.tobepaid |
| 已完成     |            |                | 客户款完成了 | cus.done |
| 已取消     |            |                | 取消的订单 | cus.cancel |
| 全部订单   |            |                | 所有订单 | !cus.incart |

注意，上述的状态之间并不是互斥的。

**用户未结清** 在用户界面显示为 **未结清** ， **工厂未结清** 在用户界面上不可见。

**建议的列表：**

|  状态名称  | 操作按钮 |     查找条件     |
|:-----------|:--------:|:-----------------|
| 待确认     | 审核     | cus.tbc          |
| 确认，已交工厂 | 完工 / 确认用户价格 | fac.in  |
| 工厂完工，但未结清 | 付款给工厂 | fac.tbp  |
| 用户价格已确认，但未结清 | 扣款 | cus.tbp |
| 用户付清   |         | cus.done         |
| 已付清工厂 |         | fac.done         |
| 已取消     |         | cus.cancel       |
| 全部订单   |         | cus.ic           |

**工厂完工，但未结清** 和 **已付清工厂** 在用户界面上不可见。

**订单的状态**
- 订单中的客户相关
 - 未发货的订单
 - 已发货且未付清的订单
 - 完成的订单
- 订单中的工厂相关
 - 在厂的订单
 - 工厂完成且未付清的订单
 - 完成的订单

In Code

- CusOrder
 1. InCart
 2. Submit
 3. Confirm
 4. ConfirmPrice
 5. Done
- FacOrder
 1. In
 2. ConfirmPrice
 3. Done

右边的状态

| CusOrder | FacOrder | State |
|:------:|:-------:|:-------|
| InCart | | |
| Submit | | 待确认 |
| Confirm | In | 已交工厂 |
|  | ConfirmPrice | 工厂完工 |
| ConfirmPrice | | 未结清 |
| Done |  | 已完成 |
| Cancel | | 已取消 |

这篇文档从不同的使用者视角提出功能点。林仔看一下这些功能点和你心中的有没有出入。

用户视角
--------

- 浏览产品
 - 加入购物车
- 购物车
 - 删除其中的产品
 - 为其中的产品加注释
- 订单
 - 浏览订单
 - *取消订单*
 - *修改注释*
- 账户信息
 - 查看
 - 更改
- 地址信息
 - 查看
 - 更改

上述功能点中，现阶段不提供的功能用斜体表示，下同。

商户视角
---------

- 产品
 - 浏览
 - 更新
 - 发布
 - 批量发布
- 客户
 - 浏览
 - 创建
 - 审核
 - 修改信息
 - *删除*
 - 充值
- 工厂
 - 浏览
 - 创建
 - 修改信息
 - *删除*
 - 打款
- 订单
 - 浏览
 - 操作<sup>在下面展开</sup>
 - 查看统计信息（销售记录）
- 财务
 - 浏览记录
 - *查看统计信息*

**订单的操作**
- 订单
 - 选择工厂
- 客户单
 - 取消
 - 确认
 - 填写价格
 - 确认价格
 - 扣款
- 工厂单
 - 进入工厂
 - 工厂完工
 - 填写价格
 - 确认价格
 - 扣款


需求分析
========

这个文档的主要目的是 **相互印证** 我们对这个网站的理解是否一致。如果不一致，可能会导致频繁、往复的修改，增加无用的工作量。希望这个文档能帮助到我们的工作。比如，这个文档就能把名词的使用统一一下。（统一名词仅仅是为了方便讨论， **不决定** 最终的文案）


总括
--------
本网站的目的是力图表现一种给定的经济活动，从而方便使用者。


人物角色
--------

在此经济活动中涉及到的所有角色，有以下三种：

- **杨X**（或称 **商家**），中间倒卖产品的人，也是委托制作网站的人。
- **客户**，来杨超这里买东西的人
- **工厂**，帮委托方杨X制作产品的人

其中，网站的用户是 客户 和 商家。


实体和概念
----------

这个经济活动中的 **核心实体** 只有一个东西，它在三方之间被买卖。这个东西可以称之为 **产品**。

而除了 产品 之外，还有以下实体：

- **原材料**，用来加工成 产品 的东西。有三种原材料：
 1. **贵重金属** (gold)，如PT950、黄18K金等。
 2. **主石** (stone)，“大”石头。
 3. **辅石** (small stone)，“小”石头，主石和辅石的区别还在于工厂不提供主石，客户不提供辅石。

除了以上两种实体，还会有以下概念：

- **货品** (product)，一个产品种类，用来指代一类“产品”，由商家展示给客户，供其选择。（工厂也会有货品的概念，不过，工厂不是这个网站的用户，就不予讨论了。）
- **订单**，在不同角色心目中，其概念是不同的，为了方便讨论，后面我们会给出不同的命名。


主要流程
------------------

**产品**（核心实体）将经历以下流程：

1. 存在于商家的描述中。（存在于客户的想象中，被客户需求）
3. 商家和客户对此产品的形象、详细参数以及价格等达成一致。
4. 商家将需求和原材料等送交工厂。
5. 工厂制作这个东西。
6. 制作完成后，工厂将它发给商家。
7. 商家将这个东西发给客户。

总结来说这个 产品 的路线是 **商家** 至 **工厂** 再至 **商家** 最后至 **客户**。

从客户的视角看，相对应的流程可以简化为： **客户** 至 **商家** 再至 **客户**。当然，也可以毫不简化，直接将完整的流程呈现给客户。

从工厂的视角看，流程又不相同。不过，这里就不予讨论了。

**网站需要给客户和商家提供相应的流程描述功能。也就是现有的订单页面。**

目前，网站对应于流程1的功能是：**客户定制**；
对应于流程2的功能是 **货品展示**（首页）；
对应于流程3的功能分散于主页、购物车、订单等页面；
对应于流程4的功能在订单页面的 **选择工厂** 等；
没有对应于流程5的功能（也不需要）；
对应于流程6的功能是订单页面的 **工厂价格**；
对应于流程7的功能存在于订单页面。


委托关系及与之相应的单据
------------------------

在这个流程中存在的委托关系如下：

1. **客户** 委托 **商家** 制作产品
2. **商家** 委托 **工厂** 制作产品

委托关系需要一个单据来证明其存在性。关系1对应的称之为 **客户单**，关系2对应的称之为 **工厂单**。（这两个单据对应的是同一个 产品 。）

对应的流程如下：

**客户单：**

1. 客户方提供需求；
2. 商家给出产品；
3. 客户方付款。

**工厂单：**

1. 商家给出需求（有时候也会提供原材料）；
2. 工厂方给出产品；
3. 商家付款。

**网站需要存留单据，供需要的时候查找。**

通过上面的分析我们可以看出，一个产品的订单记录由两方面构成：客户单和工厂单。工厂单和客户单既有关联又相对独立。工厂单的报价影响了客户单的报价。

两种订单的的财务往来不会互相影响。

将订单分成这两个部分，并不意味着一定要在界面上分别显示这两个部分，仅仅是为了明确逻辑，便于建模。


财务往来
------------------------

三方间的财务往来可列如下：

1. （商家和客户）（对应客户单）： 产品 和金钱
2. （商家和工厂）（对应工厂单）： 产品 、原材料和金钱。 **原材料中需要网站记录的只有辅石。**

从客户和商家确立财务关系开始， **客户单** 的财务属性将由下面两个因素决定：

- 商家是否发出产品（或谓：客户是否已经收到产品）
- 客户是否已经付清款项

准确来说，商家已发出产品，并不意味这对方已经收到。同样，客户付钱的时候，商家也不能立刻收到款项，但这里没有必要区分的这么清楚，我们不是做支付宝的公司。

一般来说，上面两个因素是有着明确的时间顺序的：即商家先发货，对方再付款。但也有例外的情况， **现在网站的解决方案是使客户拥有预付款账户** 。

从商家和工厂确认财务关系开始， **工厂单** 的财务属性由以下两个因素决定：

- 商家提供的原材料是否已经到厂（即工厂收到商家的原材料）（在现实中，原材料的支付是批量的）
- 工厂是否已经发货（即商家收到货）
- 商家是否付清款项（即工厂收到钱）

**财务属性也是商家和客户所关注的内容，因此，要提供通过这些财务属性筛选订单的功能。**


账户
----

账户是对财务往来的记录。 逻辑上，三方将各自对各种资源拥有一个单独的账户，即：

- 商家拥有产品账户、原材料账户和金钱账户。
- 客户拥有产品账户和金钱账户。
- 工厂拥有产品账户、原材料账户和金钱账户。

由于产品不可拆分、不可度量，惯例上产品账户是不必要的。当然，产品将会在其他的账户中以链接的方式出现。

理想方案：

- 商家拥有 
 - **原材料账户**
 - **金钱账户**
- 客户拥有
 - 金钱账户
- 工厂拥有
 - 原材料账户
 - 金钱账户

**网站需提供从各个角度查找记录的功能。** 即：商家和客户都可以查看自己的所有账户的记录。

**每个账户的充钱都是由商家操作的。**

订单号
---------
因大订单的单号其实使用意义不是很大，因为业务往来上基本上都是使用的单件货品的单号，也就是小单号，所以订单号的设置如下：

1. 大订单没有订单号
2. 小订单的订单号为4位年月日加4位序号。

**year(1) + month(1) + day(2) + serial-number(4)**

year:
**2012 ===> A**

month:
**HEX**

day:
**00**

serial number:
**0000**
